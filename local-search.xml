<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Flutteré¡¹ç›®æ›´æ–°SDK</title>
    <link href="/2023/11/02/Flutter%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7SDK/"/>
    <url>/2023/11/02/Flutter%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7SDK/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠé¡¹ç›®çš„SDKæ›´æ–°äº†ï¼Œè®°å½•ä¸€ä¸‹ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯fvmä½œä¸ºç‰ˆæœ¬ç®¡ç†ã€‚</p><ol><li>é¦–å…ˆè¦å»å®˜ç½‘æŸ¥è¯¢æœ€æ–°çš„ç‰ˆæœ¬åˆ—è¡¨ä»¥åŠFlutterå’ŒDartå¯¹åº”å…³ç³»ã€‚<br><a href="https://flutter.cn/docs/development/tools/sdk/releases">ç‚¹å‡»æŸ¥çœ‹Flutter SDK ç‰ˆæœ¬åˆ—è¡¨</a></li><li>ä½¿ç”¨<code>fvm install (flutterç‰ˆæœ¬å·)</code></li><li>ä½¿ç”¨<code>fvm list</code>æŸ¥çœ‹SDKåˆ—è¡¨</li><li>ä½¿ç”¨Android Studioæ‰“å¼€é¡¹ç›®ï¼Œä½¿ç”¨<code>fvm use (flutterç‰ˆæœ¬å·)</code></li><li>æ‰“å¼€<code>pubspec.yaml</code>ï¼Œæ›´æ–°ä¸‹é¢çš„ä»£ç </li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">environment:<br>     sdk: <span class="hljs-string">&quot;&gt;=3.0.5 &lt;4.0.0&quot;</span><br>     <span class="hljs-comment">//è¿™é‡Œæ˜¯Dart çš„ç‰ˆæœ¬å·</span><br></code></pre></td></tr></table></figure><ol start="6"><li>åœ¨<code>Android Studio</code>ï¼Œåœ¨<code>Preferences | Languages &amp; Frameworks</code> - <code>Dart</code>é‡Œæ›´æ¢<code>Dart</code>çš„SDKåœ°å€</li><li>å‡çº§ä¸‰æ–¹åº“çš„ç‰ˆæœ¬</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutteréš¾ç‚¹è§£æ</title>
    <link href="/2023/11/02/Flutter%E9%9A%BE%E7%82%B9%E8%A7%A3%E6%9E%90/"/>
    <url>/2023/11/02/Flutter%E9%9A%BE%E7%82%B9%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="1-è·¨é¡µé¢æ›´æ–°æ•°æ®"><a href="#1-è·¨é¡µé¢æ›´æ–°æ•°æ®" class="headerlink" title="1.è·¨é¡µé¢æ›´æ–°æ•°æ®"></a>1.è·¨é¡µé¢æ›´æ–°æ•°æ®</h2><p>åœ¨ä½¿ç”¨<code>GetX</code>çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™éœ€è¦è·¨é¡µé¢ä¿®æ”¹æ•°æ®ï¼Œæ¯”å¦‚æœ‰ABCä¸‰ä¸ªé¡µé¢ï¼Œåœ¨<code>C</code>é¡µé¢çš„æŸä¸ªå€¼æ›´æ”¹å€¼æ—¶ï¼Œéœ€è¦åœ¨<code>A</code>é¡µé¢ä½“ç°å‡ºæ¥ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°<code>Get.find&lt;SomeController&gt;();</code>ã€‚</p><p>ä½†æ˜¯å¦‚æœ<code>SomeController</code>æ²¡æœ‰æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è°ƒç”¨<code>Get.put()</code>æ–¹æ³•ï¼Œå°±ä¼šå‘ç”Ÿ<code>Crash</code>ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­<code>SomeController</code>æ˜¯å¦æ³¨å†Œè¿‡ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">bool</span> isControllerRegistered = GetInstance().isRegistered&lt;SomeController&gt;();<br><span class="hljs-keyword">if</span> (isControllerRegistered) &#123;<br>    SomeController controller = Get.find&lt;SomeController&gt;();<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-onInitä¸è°ƒç”¨çš„é—®é¢˜"><a href="#2-onInitä¸è°ƒç”¨çš„é—®é¢˜" class="headerlink" title="2.onInitä¸è°ƒç”¨çš„é—®é¢˜"></a>2.onInitä¸è°ƒç”¨çš„é—®é¢˜</h2><p>ä½¿ç”¨<code>GetX</code>çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™<code>controller</code>çš„<code>onInit</code>æ–¹æ³•ä¸è°ƒç”¨ï¼ŒåŸå› å¾ˆå¯èƒ½æ˜¯åœ¨<code>view</code>ä¸­æ²¡æœ‰è°ƒç”¨<code>controller</code>çš„æ–¹æ³•ï¼Œ<code>controller</code>æ²¡æœ‰åŠ è½½çš„ç¼˜æ•…</p><h2 id="3-TabBarçš„é—®é¢˜"><a href="#3-TabBarçš„é—®é¢˜" class="headerlink" title="3.TabBarçš„é—®é¢˜"></a>3.TabBarçš„é—®é¢˜</h2><p>å¦‚æœä½¿ç”¨<code>PageView</code>é…åˆ<code>BottomNavigationBarItem</code>ï¼Œåœ¨è¿›å…¥Appçš„æ—¶å€™ï¼Œæ‰€æœ‰Pageéƒ½ä¼šåŠ è½½ï¼Œæœ‰äº›æ—¶å€™è¿™æ ·åšä¼šäº§ç”Ÿé—®é¢˜ã€‚(æ¯”å¦‚béœ€è¦açš„ä¸€äº›æ•°æ®ï¼Œä½†æ˜¯bå·²ç»åŠ è½½å®Œæˆäº†ï¼Œaçš„æ•°æ®è¿˜æ²¡è¯·æ±‚æˆåŠŸ)ã€‚<br>æ‰€æœ‰æœ€å¥½æ˜¯ä½¿ç”¨ä¸‹åˆ—ç¤ºä¾‹ä»£ç ï¼ˆä¸ä½¿ç”¨Pageviewï¼‰ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Scaffold(<br>    appBar: appbar,<br>    body: pages[currentIndex],<br>    bottomNavigationBar: BottomNavigationBar(<br>        items: [<br>            item1,<br>            item2,<br>            ...<br>        ]<br>    )<br>);<br></code></pre></td></tr></table></figure><h2 id="4-Textç»„ä»¶æ˜¾ç¤ºçº¢è‰²å­—ä½“ï¼Œå¸¦æœ‰é»„è‰²ä¸‹åˆ’çº¿"><a href="#4-Textç»„ä»¶æ˜¾ç¤ºçº¢è‰²å­—ä½“ï¼Œå¸¦æœ‰é»„è‰²ä¸‹åˆ’çº¿" class="headerlink" title="4.Textç»„ä»¶æ˜¾ç¤ºçº¢è‰²å­—ä½“ï¼Œå¸¦æœ‰é»„è‰²ä¸‹åˆ’çº¿"></a>4.Textç»„ä»¶æ˜¾ç¤ºçº¢è‰²å­—ä½“ï¼Œå¸¦æœ‰é»„è‰²ä¸‹åˆ’çº¿</h2><p>è¿™æ˜¯å› ä¸ºè¯¥<code>Widget</code>æ²¡æœ‰è¢«<code>Scaffold</code>ã€<code>Dialog</code>ç­‰åŒ…è£¹ï¼Œå› ä¸ºè¿™äº›ç»„ä»¶å†…ç½®<code>DefaultTextStyle</code>ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ä¸Šè¿°ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨<code>DefaultTextStyle</code>åŒ…è£¹ï¼Œè¿™æ ·<code>Text</code>å°±æ˜¾ç¤ºæ­£å¸¸äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºFlutterçš„WebRTCå­¦ä¹ </title>
    <link href="/2023/10/31/%E5%9F%BA%E4%BA%8EFlutter%E7%9A%84WebRTC%E5%AD%A6%E4%B9%A0/"/>
    <url>/2023/10/31/%E5%9F%BA%E4%BA%8EFlutter%E7%9A%84WebRTC%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºäºFlutterçš„WebRTCå­¦ä¹ "><a href="#åŸºäºFlutterçš„WebRTCå­¦ä¹ " class="headerlink" title="åŸºäºFlutterçš„WebRTCå­¦ä¹ "></a>åŸºäºFlutterçš„WebRTCå­¦ä¹ </h1><p>å­¦ä¹ WebRTCä¹‹å‰ï¼Œå…ˆéœ€è¦äº†è§£å‡ ä¸ªåè¯ï¼š</p><p>ä¿¡ä»¤æœåŠ¡å™¨ï¼š<br>æ˜¯ç”¨æ¥äº¤æ¢æ•°æ®çš„ï¼Œä¾‹å¦‚äº¤æ¢<code>SDP</code>ç­‰ã€‚<br>ä¿¡ä»¤æœåŠ¡å™¨çš„åè®®ç”±å¤šç§æ–¹å¼ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<code>XHR</code>å’Œ<code>WebSocket</code>è¿›è¡Œæ•°æ®äº¤æ¢</p><p>SDP:<br>Session Discription Protocol(ä¼šè¯æè¿°åè®®)<br>åŒæ–¹è¿›è¡Œåª’ä½“åå•†(ä¹Ÿå°±æ˜¯<strong>äº¤æ¢SDP</strong>)çš„æ—¶å€™ä½¿ç”¨(ä¾‹å¦‚ï¼šåŒæ–¹ä½¿ç”¨çš„éŸ³è§†é¢‘ç¼–ç æ ¼å¼ç­‰ç­‰)<br>é€šè¿‡<strong>ä¿¡ä»¤æœåŠ¡å™¨</strong>è¿›è¡Œä¼ è¾“</p><p>Candidate:<br>ç½‘ç»œä¿¡æ¯ï¼Œé€šè¿‡<strong>ä¿¡ä»¤æœåŠ¡å™¨</strong>è¿›è¡Œäº¤æ¢</p><p>ICE:<br>æ˜¯ä¸€ç§æ¡†æ¶ï¼Œä½¿å„ç§NATç©¿é€æŠ€æœ¯å¯ä»¥å®ç°ç»Ÿä¸€ï¼Œè¯¥æŠ€æœ¯å¯ä»¥è®©å®¢æˆ·ç«¯æˆåŠŸåœ°ç©¿é€è¿œç¨‹ç”¨æˆ·ä¸ç½‘ç»œä¹‹é—´å¯èƒ½å­˜åœ¨çš„å„ç±»é˜²ç«å¢™ã€‚</p><p>StunæœåŠ¡å™¨ï¼š<br>STUNæœåŠ¡å™¨èƒ½å¤ŸçŸ¥é“Peer-Aä»¥åŠPeer-Bçš„å…¬ç½‘IPåœ°å€åŠç«¯å£</p><p>WebRTCä¸»è¦æµç¨‹åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>åª’ä½“åå•†<br>Peer-Aå’ŒPeerBé€šè¿‡<strong>ä¿¡ä»¤æœåŠ¡å™¨</strong>è¿›è¡Œåª’ä½“åå•†ï¼ŒåŒæ–¹äº¤æ¢çš„æ•°æ®ç”±<strong>SDP</strong>æè¿°</li><li>ç½‘ç»œåå•†<br>Peer-Aå’ŒPeerBé€šè¿‡<strong>StunæœåŠ¡å™¨</strong>è·å–åˆ°å„è‡ªçš„ç½‘ç»œä¿¡æ¯(å¦‚ï¼šIPï¼Œç«¯å£ç­‰)ï¼Œç„¶åé€šè¿‡<strong>ä¿¡ä»¤æœåŠ¡å™¨</strong>è½¬å‘</li><li>å»ºç«‹è¿æ¥<br>å¦‚æœæ²¡æœ‰ç›´è¿ï¼Œé‚£å°±é€šè¿‡<strong>TURNä¸­è½¬æœåŠ¡å™¨</strong>è¿›è¡Œè½¬å‘éŸ³è§†é¢‘æ•°æ®, æœ€ç»ˆå®Œæˆè§†é¢‘é€šè¯</li></ol><h4 id="WebRTCä»£ç éƒ¨åˆ†çš„æµç¨‹"><a href="#WebRTCä»£ç éƒ¨åˆ†çš„æµç¨‹" class="headerlink" title="WebRTCä»£ç éƒ¨åˆ†çš„æµç¨‹"></a>WebRTCä»£ç éƒ¨åˆ†çš„æµç¨‹</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">RTCVideoRenderer _localRenderer = RTCVideoRenderer(); <span class="hljs-comment">//æœ¬åœ°æµæ¸²æŸ“</span><br>RTCVideoRenderer _remoteRenderer = RTCVideoRenderer(); <span class="hljs-comment">//è¿œç¨‹æµæ¸²æŸ“</span><br>MediaStream? _localStream; <span class="hljs-comment">//æœ¬åœ°æµ</span><br></code></pre></td></tr></table></figure><h5 id="1-è·å–åª’ä½“æµ"><a href="#1-è·å–åª’ä½“æµ" class="headerlink" title="1.è·å–åª’ä½“æµ"></a>1.è·å–åª’ä½“æµ</h5><p>ä½¿ç”¨ <code>getUserMedia</code>è·å–åª’ä½“æµï¼Œè¿”å›ä¸€ä¸ª<code>stream</code>å¯¹è±¡ï¼Œå¯ä»¥ç”¨<code>RTCVideoRenderer</code>æ¥è¿›è¡Œæ¸²æŸ“ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart">navigator<br>    .mediaDevices<br>    .getUserMedia(P2PConstraints.MEDIA_CONSTRAINTS)<br>    .then(stream) &#123;<br>        _localStream = stream;<br>        <span class="hljs-comment">//æ¸²æŸ“æœ¬åœ°æµ</span><br>        setState(() &#123;<br>          _localRenderer.srcObject = stream;<br>        &#125;);<br>    &#125;<br></code></pre></td></tr></table></figure><h5 id="2-ç”Ÿæˆpcå¯¹è±¡"><a href="#2-ç”Ÿæˆpcå¯¹è±¡" class="headerlink" title="2.ç”Ÿæˆpcå¯¹è±¡"></a>2.ç”Ÿæˆpcå¯¹è±¡</h5><p><code>pc</code>å¯¹è±¡å…¶å®å°±æ˜¯æ˜¯<code>RTCPeerConnection</code>å¯¹è±¡ï¼Œè¯¥ç±»æ˜¯æœ€ä¸»è¦çš„<code>WebRTC</code>ç±»ï¼Œè´Ÿè´£å»ºç«‹<code>WebRTC</code>è¿æ¥ï¼Œå¤„ç†éŸ³è§†é¢‘æ•°æ®æµçš„ä¼ è¾“</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">RTCPeerConnection? pc;<br>pc = <span class="hljs-keyword">await</span> createPeerConnection(P2PConstraints.PC_CONSTRAINTS);<br></code></pre></td></tr></table></figure><h5 id="3-å°†streamæ·»åŠ åˆ°peer-Aå¯¹è±¡"><a href="#3-å°†streamæ·»åŠ åˆ°peer-Aå¯¹è±¡" class="headerlink" title="3. å°†streamæ·»åŠ åˆ°peer-Aå¯¹è±¡"></a>3. å°†<code>stream</code>æ·»åŠ åˆ°peer-Aå¯¹è±¡</h5><p>å°†<code>ç¬¬1æ­¥</code>è·å–åˆ°çš„<code>stream</code>æ·»åŠ åˆ°<code>peer-A</code>å¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">_localStream!.getTracks().forEach((track) &#123;<br>    pc!.addTrack(track, _localStream!);<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="4-peer-Aåˆ›å»ºoffer"><a href="#4-peer-Aåˆ›å»ºoffer" class="headerlink" title="4.peer-Aåˆ›å»ºoffer"></a>4.peer-Aåˆ›å»º<code>offer</code></h5><p>åˆ›å»º<code>offer</code>ä¼šè¿”å›ä¸€ä¸ª<code>RTCSessionDescription</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>sdp</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">RTCSessionDescription sdp =<br>          <span class="hljs-keyword">await</span> pc!.createOffer(P2PConstraints.SDP_CONSTRAINTS);<br></code></pre></td></tr></table></figure><h5 id="5-è®¾ç½®æœ¬åœ°æè¿°"><a href="#5-è®¾ç½®æœ¬åœ°æè¿°" class="headerlink" title="5.è®¾ç½®æœ¬åœ°æè¿°"></a>5.è®¾ç½®æœ¬åœ°æè¿°</h5><p>è®¾ç½®æœ¬åœ°æè¿°<br>è°ƒç”¨<code>setLocalDescription</code>æ–¹æ³•åï¼Œä¼šè§¦å‘<code>pc</code>çš„<code>iceCandidate</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">await</span> pc!.setLocalDescription(sdp);<br></code></pre></td></tr></table></figure><h5 id="6-å°†peer-Açš„sdpé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™peer-B"><a href="#6-å°†peer-Açš„sdpé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™peer-B" class="headerlink" title="6.å°†peer-Açš„sdpé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™peer-B"></a>6.å°†<code>peer-A</code>çš„<code>sdp</code>é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™<code>peer-B</code></h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//è¿™ä¸ªæ˜¯è‡ªå·±å®ç°çš„æ–¹æ³•ï¼Œ</span><br><span class="hljs-comment">//é€šè¿‡websocket æˆ–è€… XHR å‘é€sdpåˆ°è¿œç«¯(peer-B)</span><br><span class="hljs-keyword">await</span> sendOfferSdp(sdp);<br></code></pre></td></tr></table></figure><h5 id="7-æ”¶åˆ°è¿œç«¯sdp"><a href="#7-æ”¶åˆ°è¿œç«¯sdp" class="headerlink" title="7.æ”¶åˆ°è¿œç«¯sdp"></a>7.æ”¶åˆ°è¿œç«¯<code>sdp</code></h5><p>æ ¹æ®ä¿¡ä»¤æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯ï¼Œè·å–è¿œç«¯çš„<code>sdp</code>ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">RTCSessionDescription answerSdp =<br>          RTCSessionDescription(sdp, type);<br></code></pre></td></tr></table></figure><h5 id="8-è®¾ç½®è¿œç«¯æè¿°"><a href="#8-è®¾ç½®è¿œç«¯æè¿°" class="headerlink" title="8.è®¾ç½®è¿œç«¯æè¿°"></a>8.è®¾ç½®è¿œç«¯æè¿°</h5><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†äº¤æ¢<code>sdp</code>ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">pc!.setRemoteDescription(answerSdp);<br></code></pre></td></tr></table></figure><h5 id="9-äº¤æ¢iceåœ°å€ä¿¡æ¯"><a href="#9-äº¤æ¢iceåœ°å€ä¿¡æ¯" class="headerlink" title="9.äº¤æ¢iceåœ°å€ä¿¡æ¯"></a>9.äº¤æ¢iceåœ°å€ä¿¡æ¯</h5><p>åœ¨<code>ç¬¬2æ­¥</code>ä¸­ç”Ÿæˆåˆ›å»º<code>pc</code>åï¼Œå®ç°ç›‘å¬<code>onIceCandidate</code>ï¼Œ<code>ç¬¬5æ­¥</code>ä»¥åä¼šè‡ªåŠ¨è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè·å–<code>candidate</code>ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">pc!.onIceCandidate = (candidate) &#123;<br>    <span class="hljs-comment">//å‘é€candidateï¼Œè‡ªå·±å®ç°çš„æ–¹æ³•ï¼Œé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€candidate</span><br>    sendCandidate(candidate);<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter,WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Runtimeåº”ç”¨(1)-å…¨å±€ä¿®æ”¹å­—ä½“</title>
    <link href="/2018/11/01/Runtime%E5%BA%94%E7%94%A8-1-%E5%85%A8%E5%B1%80%E4%BF%AE%E6%94%B9%E5%AD%97%E4%BD%93/"/>
    <url>/2018/11/01/Runtime%E5%BA%94%E7%94%A8-1-%E5%85%A8%E5%B1%80%E4%BF%AE%E6%94%B9%E5%AD%97%E4%BD%93/</url>
    
    <content type="html"><![CDATA[<h4 id="ä¸€èˆ¬æ­¥éª¤"><a href="#ä¸€èˆ¬æ­¥éª¤" class="headerlink" title="ä¸€èˆ¬æ­¥éª¤"></a>ä¸€èˆ¬æ­¥éª¤</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥è¯´ä¸‹ä¸€èˆ¬æƒ…å†µä¸‹æ›´æ¢å­—ä½“çš„æ­¥éª¤:</p><ol><li><p>æˆ‘ä»¬ä»ç½‘ä¸Šdownä¸‹æ¥ä¸€ä¸ªttfæ ¼å¼çš„å­—ä½“ï¼Œæ‹–å…¥åˆ°é¡¹ç›®ä¸­ï¼Œå¦‚å›¾æ‰€ç¤º</p><img src="/img/Runtime01/runtime_01.png"></li><li><p>åœ¨info.plistæ–‡ä»¶ä¸­æ·»åŠ <code>Fonts provided by application</code>ï¼Œ<code>item</code>å†™ä¸Šæ–‡ä»¶åï¼Œæˆ‘è¿™é‡Œæ˜¯<code>è”¡äº‘æ±‰éš¶ä¹¦ä¹¦æ³•å­—ä½“.ttf</code>ã€‚è¿™æ—¶å€™éœ€è¦æ£€æŸ¥ä¸€ä¸‹<code>Build Phases</code> â€“&gt; <code>Copy Bundle Resources</code>é‡Œé¢æœ‰æ²¡æœ‰æˆ‘ä»¬æ‹–è¿›å»çš„æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼ŒæŠŠå®ƒAddè¿›å»ã€‚</p><img src="/img/Runtime01/runtime_02.png">ä½†æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜ä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªå­—ä½“çš„`PostScript`åç§°é‚£åˆ°åº•è¦æ€ä¹ˆæ‰¾å‘¢ï¼Ÿæˆ‘ä»¬å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…è¿™ä¸ªå­—ä½“ï¼Œè¿™æ—¶å€™ä¼šåœ¨å­—ä½“å†Œçœ‹åˆ°å®ƒï¼Œç„¶åå¦‚å›¾æ“ä½œå°±å¯ä»¥äº†ã€‚<img src="/img/Runtime01/runtime_03.png"></li><li><p>æœ€åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼Œå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objc">label.font = [<span class="hljs-built_in">UIFont</span> fontWithName:<span class="hljs-string">@&quot;CaiYunHanMaoBi-LiShu&quot;</span> size:<span class="hljs-number">11</span>];<br></code></pre></td></tr></table></figure></li></ol><h4 id="Runtimeæ›´æ¢å…¨å±€å­—ä½“"><a href="#Runtimeæ›´æ¢å…¨å±€å­—ä½“" class="headerlink" title="Runtimeæ›´æ¢å…¨å±€å­—ä½“"></a>Runtimeæ›´æ¢å…¨å±€å­—ä½“</h4><p>ä¸Šé¢åªæ˜¯ç®€å•å›é¡¾äº†ä¸€ä¸‹æ›´æ¢å­—ä½“çš„æ­¥éª¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ›´æ¢å­—ä½“éƒ½è¿™æ ·ï¼Œæœªå…æœ‰ç‚¹éº»çƒ¦ã€‚å¦‚æœè¯´æˆ‘ä»¬é¡¹ç›®å·²ç»å®Œæˆäº†ï¼Œè€æ¿çªç„¶æ¥ä¸€å¥ï¼Œå—¯ï¼Œè‹¹æœå­—ä½“å¤ªä¸‘äº†ï¼Œæˆ‘ä»¬æ¢ä¸ªå­—ä½“ï¼Œä½ æ˜¯ä¸æ˜¯è¦å“­æ™•åœ¨å•æ‰€äº†ã€‚<br>ä¸‹é¢å°±ç¥­å‡ºæˆ‘ä»¬çš„å¤§æ€å™¨ â€“ <code>Runtime</code>ã€‚</p><h5 id="ç§»èŠ±æ¥æœ¨"><a href="#ç§»èŠ±æ¥æœ¨" class="headerlink" title="ç§»èŠ±æ¥æœ¨"></a>ç§»èŠ±æ¥æœ¨</h5><p>æˆ‘ä»¬æƒ³åˆ°æ¯æ¬¡æ›´æ¢å­—ä½“éƒ½ä¼šè°ƒ<code>systemFontOfSize:</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯åªè¦æˆ‘ä»¬äº¤æ¢è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•é‡Œé¢æ¢æˆæˆ‘ä»¬è‡ªå·±çš„å­—ä½“ä¸å°±è¡Œäº†å—ã€‚è¯´å¹²å°±å¹²ã€‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª<code>UIFont</code>çš„åˆ†ç±»<code>XX</code></p>   <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-meta">#import <span class="hljs-string">&quot;UIFont+XX.h&quot;</span></span><br>    <br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">UIFont</span> (<span class="hljs-title">XX</span>)</span><br>    <br>+ (<span class="hljs-type">void</span>)load &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>  <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>      Method systemMethod = class_getClassMethod([<span class="hljs-built_in">UIFont</span> <span class="hljs-keyword">class</span>], <span class="hljs-keyword">@selector</span>(systemFontOfSize:));<br>      Method swizzMethod = class_getClassMethod([<span class="hljs-built_in">UIFont</span> <span class="hljs-keyword">class</span>], <span class="hljs-keyword">@selector</span>(my_systemFontOfSize:));<br>      method_exchangeImplementations(systemMethod, swizzMethod);<br>  &#125;);<br>&#125;<br>    <br>+ (<span class="hljs-built_in">UIFont</span> *)my_systemFontOfSize:(<span class="hljs-built_in">CGFloat</span>)size &#123;<br>    [<span class="hljs-built_in">UIFont</span> my_systemFontOfSize:size];<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIFont</span> fontWithName:<span class="hljs-string">@&quot;CaiYunHanMaoBi-LiShu&quot;</span> size:size];<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè¿è¡ŒæŸ¥çœ‹æ•ˆæœ<br><img src="/img/Runtime01/runtime_04.GIF"></p><p>æˆ‘ä»¬å‘ç°ï¼Œè¿˜æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ§ä»¶çš„å­—ä½“æ˜¯æ²¡æœ‰æ”¹å˜çš„ã€‚æ˜¯ä¸æ˜¯æœ‰å¥½å¤šæ§ä»¶æ˜¯ä¸ä¼šè°ƒç”¨<code>systemFontOfSize:</code>æ–¹æ³•çš„ã€‚é‚£æ€ä¹ˆåŠï¼Ÿ</p><h5 id="å·å¤©æ¢æŸ±"><a href="#å·å¤©æ¢æŸ±" class="headerlink" title="å·å¤©æ¢æŸ±"></a>å·å¤©æ¢æŸ±</h5><p>å…µæ¥å°†æŒ¡ï¼Œæ°´æ¥åœŸæ©ï¼Œè¢–å­ä¸€æ’¸å°±æ˜¯å¹²ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¾ç¤º<code>text</code>çš„æ§ä»¶åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯<code>UILabel</code>ã€‚å°±ç®—æ˜¯ä»€ä¹ˆ<code>UIButton</code>ï¼Œ<code>UITextField</code>çš„ç”¨äºæ˜¾ç¤º<code>Text</code>çš„å­æ§ä»¶ï¼Œä¹Ÿæ˜¯ç»§æ‰¿äº<code>UILabel</code>ã€‚æƒ³åˆ°è¿™ç‚¹ï¼Œæˆ‘ä»¬å°±å»æ‰“<code>UILabel</code>çš„ä¸»æ„ï¼Œåªè¦æˆ‘ä»¬æ”¹å˜æ‰€æœ‰çš„<code>UILabel</code>çš„å­—ä½“ä¸å°±å¯ä»¥äº†å—ï¼Ÿ<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦äº¤æ¢å“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯: <code>willMoveToSuperview:</code>ã€‚<br>çœ‹æ–¹æ³•åæˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ§ä»¶å°†è¦åŠ è½½åˆ°çˆ¶viewä¸Šæ—¶è°ƒç”¨ï¼Œè¿™æ—¶å€™æ§ä»¶çš„å„ç§å±æ€§åŸºæœ¬å·²ç»ç¡®å®šäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å·å·å¾—ä¿®æ”¹äº†ã€‚</p>   <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-meta">#import <span class="hljs-string">&quot;UILabel+FontChange.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-string">&lt;objc/runtime.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CustomFontName @<span class="hljs-string">&quot;CaiYunHanMaoBi-LiShu&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">UILabel</span> (<span class="hljs-title">FontChange</span>)</span><br><br>+ (<span class="hljs-type">void</span>)load &#123;<br>   <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>   <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>       SEL systemSel = <span class="hljs-keyword">@selector</span>(willMoveToSuperview:);<br>       SEL swizzSel = <span class="hljs-keyword">@selector</span>(myWillMoveToSuperview:);<br>       Method systemMethod = class_getInstanceMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], systemSel);<br>       Method swizzMethod = class_getInstanceMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], swizzSel);<br>   &#125;);<br>   method_exchangeImplementations(systemMethod, swizzMethod);<br>&#125;<br><br>- (<span class="hljs-type">void</span>)myWillMoveToSuperview:(<span class="hljs-built_in">UIView</span> *)newSuperview &#123;<br>   <span class="hljs-keyword">self</span>.font = [<span class="hljs-built_in">UIFont</span> fontWithName:<span class="hljs-string">@&quot;CaiYunHanMaoBi-LiShu&quot;</span> size:<span class="hljs-keyword">self</span>.font.pointSize];<br>   [<span class="hljs-keyword">self</span> myWillMoveToSuperview:newSuperview];<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œé¡¹ç›®ã€‚WTFï¼Œå±…ç„¶å´©æºƒäº†ï¼Œå´©æºƒä¿¡æ¯å¦‚ä¸‹ï¼š</p>   <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objc">-[_UIWebViewScrollView font]: unrecognized selector sent to instance <span class="hljs-number">0x10c810a00</span><br><span class="hljs-number">2018</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span> <span class="hljs-number">17</span>:<span class="hljs-number">05</span>:<span class="hljs-number">23.843594</span>+<span class="hljs-number">0800</span> AnXinCaiFu_XSD[<span class="hljs-number">18446</span>:<span class="hljs-number">4169433</span>] *** Terminating app due to uncaught exception <span class="hljs-string">&#x27;NSInvalidArgumentException&#x27;</span>, reason: <span class="hljs-string">&#x27;-[_UIWebViewScrollView font]: unrecognized selector sent to instance 0x10c810a00&#x27;</span><br></code></pre></td></tr></table></figure><p>å´©æºƒçš„ä¸»è¦åŸå› æ˜¯<code>_UIWebViewScrollView</code>æ²¡æœ‰<code>getFont</code>è¿™ä¸ªæ–¹æ³•ï¼ˆå®ƒå½“ç„¶æ²¡æœ‰ï¼‰ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆå®ƒä¼šè°ƒåˆ°<code>getFont</code>æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å†™çš„æ˜¯<code>UIFont</code>çš„åˆ†ç±»ï¼Œ<code>self.font</code>åº”è¯¥è°ƒç”¨çš„æ˜¯<code>UILabel</code>çš„<code>getFont</code>æ–¹æ³•å‘€ï¼Ÿ</p><p>ç­”æ¡ˆå½“ç„¶æ˜¯å› ä¸ºæ¶ˆæ¯è½¬å‘ï¼Œç”±äºUIFontæ²¡æœ‰å®ç°<code>willMoveToSuperview:</code>æ–¹æ³•ï¼Œç„¶åå°±è¢«è½¬å‘åˆ°<code>_UIWebViewScrollView</code>é‚£é‡Œäº†ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰<code>getFont</code>æ–¹æ³•ï¼Œæ‰€ä»¥å°±Crashäº†ã€‚ï¼ˆå¯ä»¥å‚è€ƒiOSçš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼‰ï¼Œè¿™é‡Œä¸ç»†è¯´ï¼ˆç»†è¯´æˆ‘ä¹Ÿä¸ä¼šå•ŠğŸ˜‚ï¼‰ã€‚</p><p>é‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåˆ¤æ–­ä¸€ä¸‹å°±å¥½äº†ï¼š</p>   <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨class_addMethod()å‡½æ•°å¯¹Method Swizzlingåšäº†ä¸€å±‚éªŒè¯ï¼Œ</span><br><span class="hljs-comment"> å¦‚æœselfæ²¡æœ‰å®ç°è¢«äº¤æ¢çš„æ–¹æ³•ï¼Œä¼šå¯¼è‡´å¤±è´¥ã€‚</span><br><span class="hljs-comment"> è€Œä¸”selfæ²¡æœ‰äº¤æ¢çš„æ–¹æ³•å®ç°ï¼Œä½†æ˜¯çˆ¶ç±»æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œç»“æœå°±ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚</span><br><span class="hljs-comment"> æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œé€šè¿‡class_addMethod()çš„éªŒè¯ï¼Œå¦‚æœselfå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œclass_addMethod()å‡½æ•°å°†ä¼šè¿”å› NOï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œäº¤æ¢äº†ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">BOOL</span> isAdd = class_addMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], systemSel, method_getImplementation(swizzMethod), method_getTypeEncoding(swizzMethod));<br><span class="hljs-keyword">if</span> (isAdd) &#123;<br>    class_replaceMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], swizzSel, method_getImplementation(systemMethod), method_getTypeEncoding(systemMethod));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//å¦åˆ™ï¼Œäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°</span><br>    method_exchangeImplementations(systemMethod, swizzMethod);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘å†ä¸€æ¬¡è¿è¡Œé¡¹ç›®ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ¥è¿‘å®Œç¾äº†ã€‚<br><img src="/img/Runtime01/runtime_05.jpeg"></p><p>ä½†æ˜¯æˆ‘ä»¬å‘ç°Tabbarçš„å­—ä½“è¿˜æ˜¯é¡½å›ºçš„æ²¡æœ‰å˜åŒ–ğŸ˜“ã€‚<strong>æœ‰å¯èƒ½æ˜¯å› ä¸ºåœ¨å®ƒåŠ è½½åˆ°çˆ¶Viewä¸Šä¹‹åå†æ¬¡æ”¹å˜äº†å­—ä½“</strong></p><h5 id="å¹»å½±ç§»å½¢"><a href="#å¹»å½±ç§»å½¢" class="headerlink" title="å¹»å½±ç§»å½¢"></a>å¹»å½±ç§»å½¢</h5><p>æˆ‘ä»¬å†æƒ³ï¼Œæ¯æ¬¡UILabelè®¾ç½®å­—ä½“æ˜¯ä¸æ˜¯è¦è°ƒ<code>setFont</code>æ–¹æ³•ï¼Œå°±åƒä¸Šé¢è¯´çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±äº¤æ¢å®ƒçš„<code>setFont</code>æ–¹æ³•ï¼Œè®©å®ƒè®¾ç½®å­—ä½“çš„æ—¶å€™å·å·è°ƒæ¢æ‰å®ƒçš„å­—ä½“ã€‚</p>   <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-comment">//äº¤æ¢Setæ–¹æ³•</span><br>SEL sysSetFont = <span class="hljs-keyword">@selector</span>(setFont:);<br>SEL swizzSetFont = <span class="hljs-keyword">@selector</span>(mySetFont:);<br><br>Method sysSetFontMethod = class_getInstanceMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], sysSetFont);<br>Method swizzSetFontMethod = class_getInstanceMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], swizzSetFont);<br><br>method_exchangeImplementations(sysSetFontMethod, swizzSetFontMethod);<br>  <br>- (<span class="hljs-type">void</span>)mySetFont:(<span class="hljs-built_in">UIFont</span> *)font &#123;<br>  <span class="hljs-built_in">UIFont</span> *swizzFont = [<span class="hljs-built_in">UIFont</span> fontWithName:CustomFontName size:font.pointSize];<br>  [<span class="hljs-keyword">self</span> mySetFont:swizzFont];<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºå®Œæˆäº†å…¨å±€æ›´æ¢å­—ä½“ï¼Œè™½ç„¶ä»£ç ä¸å¤šï¼Œä½†æ˜¯ä¹Ÿè€—è´¹äº†æˆ‘ä»¬ä¸€æ®µæ—¶é—´ï¼Œè¿™å…¶ä¸­æ€æƒ³é‡äºä»£ç ã€‚<br>æˆ‘ä»¬è¦å®ç°ä»€ä¹ˆæ•ˆæœï¼Œæ€ä¹ˆåšæ‰èƒ½å®ç°æˆ‘ä»¬çš„ç›®çš„ï¼Œè¿™å…¶ä¸­ä¼šé€ æˆä»€ä¹ˆæ ·çš„åæœï¼Œæˆ–è€…ä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚è¿™æ˜¯æˆ‘ä»¬è¦æ€è€ƒçš„é—®é¢˜ï¼Œè¿™äº›ä¸ºä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯ä¿ƒè¿›æˆ‘ä»¬ç»§ç»­å­¦ä¹ çš„åŠ¨åŠ›ã€‚</p><p>ç¤ºä¾‹ä»£ç æˆ‘æ”¾åœ¨Githubä¸Šäº†ï¼Œåœ°å€ï¼š<a href="https://github.com/Shalliy/changeFont.git">https://github.com/Shalliy/changeFont.git</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>iOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£å†³â€œPod installâ€æ…¢çš„é—®é¢˜</title>
    <link href="/2018/09/04/%E8%A7%A3%E5%86%B3%E2%80%98%20Pod%20install%20%E2%80%99%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2018/09/04/%E8%A7%A3%E5%86%B3%E2%80%98%20Pod%20install%20%E2%80%99%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´ä½¿ç”¨cocopodså®‰è£…ç™¾åº¦åœ°å›¾çš„SDKï¼Œå‘ç°å¤±è´¥äº†</p><img src="/img/PodInstall/BEEABCAD3116C15F85755B6933808675.jpg" width="50%"><span id="more"></span><p>ç›´åˆ°æˆ‘çœ‹åˆ°äº†çœ‹äº†è¿™ä¹ˆä¸€ç¯‡åšå®¢ï¼š<br><a href="https://blog.csdn.net/wuquan0625/article/details/47401235">pod installé€Ÿåº¦æ…¢çš„ç»ˆæè§£å†³æ–¹æ¡ˆ - CSDNåšå®¢</a></p><p>ç°åœ¨ç®€å•è®°å½•ä¸€ä¸‹ï¼š<br>å…¶å®çœŸæ­£çš„åŸå› ä¸æ˜¯Podå‘½ä»¤ï¼Œè€Œæ˜¯åœ¨äºGithubä¸Šä»£ç åº“è®¿é—®é€Ÿåº¦å˜æ…¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»ˆæçš„è§£å†³åŠæ³•å°±æ˜¯åŠ å¿«Gitå‘½ä»¤çš„é€Ÿåº¦ã€‚        </p><p>é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½åŠ å¿«Gitå‘½ä»¤çš„é€Ÿåº¦å‘¢ï¼Œå½“ç„¶æ˜¯<code>ç§‘å­¦ä¸Šç½‘</code>äº†ğŸ¤«ã€‚<br>æˆ‘ç”¨çš„æ˜¯Shadowsocks-NG-R8ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç™¾åº¦ã€‚</p><p>æ‰“å¼€<code>Shadowsocks</code> - <code>é«˜çº§è®¾ç½®</code>é€‰é¡¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/img/PodInstall/WX20180904-135254@2x.png" width="50%"><p>çº¢æ¡†æ‰€ç¤ºåœˆå‡ºæ¥çš„å°±æ˜¯ä¸‹é¢æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ã€‚<br><strong>æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥å‘½ä»¤ï¼š</strong><br><code>git config --global http.proxy socks5://127.0.0.1:1086</code></p><p>å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›å›½å†…Gitåº“ä¹Ÿèµ°ä»£ç†ï¼ˆæˆ‘è§‰å¾—è¿˜æ˜¯å…¨å±€å¥½ï¼Œå›½å†…åº“ä¹Ÿæœ‰ç‰¹åˆ«æ…¢çš„ï¼‰ï¼Œå¯ä»¥è¾“å…¥å‘½ä»¤ï¼š<br><code>git config --global http.https://github.com.proxy socks5://127.0.0.1:1086</code></p><p><strong>å½“ç„¶ï¼Œå¦‚æœè¦æ¢å¤&#x2F;ç§»é™¤ä¸Šé¢è®¾ç½®çš„Gitä»£ç†</strong><br><code>git config --global --unset http.proxy</code><br><code>git config --global --unset http.https://github.com.proxy</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>iOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Viewçš„Layoutæ–¹æ³•ç²—è§£</title>
    <link href="/2018/08/28/View%E7%9A%84Layout%E6%96%B9%E6%B3%95%E7%B2%97%E8%A7%A3/"/>
    <url>/2018/08/28/View%E7%9A%84Layout%E6%96%B9%E6%B3%95%E7%B2%97%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/2ef48c2f0c97">https://www.jianshu.com/p/2ef48c2f0c97</a></p><pre><code class="hljs">Viewçš„Layoutæ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š    layoutSubviews    layoutIfNeeded    setNeedsLayout    setNeedsDisplay    drawRect    sizeThatFits    sizeToFit       </code></pre><span id="more"></span><h4 id="å…ˆè¯´ç»“è®º"><a href="#å…ˆè¯´ç»“è®º" class="headerlink" title="å…ˆè¯´ç»“è®º"></a>å…ˆè¯´ç»“è®º</h4><ul><li><code>layoutSubviews</code>æ–¹æ³•ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ï¼Œéœ€è¦è°ƒç”¨<code>[self setNeedsLayout]</code>æ¥è§¦å‘ã€‚</li><li><code>drawRect</code>ä¹Ÿä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ï¼Œéœ€è¦è°ƒç”¨<code>[self setNeedsDisplay]</code>æ¥è§¦å‘ã€‚</li><li>æœ€åå‰©ä¸‹<code>layoutIfNeeded</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ä½¿ç”¨çº¦æŸçš„æ—¶å€™è°ƒç”¨ï¼Œ**å¯ä»¥ç«‹å³æ›´æ–°æ•ˆæœ(ç«‹å³åˆ·æ–°)**ã€‚(ä¾‹å¦‚ï¼šautoLayout è·Ÿ frame æ··ç”¨)<code>setNeedsLayout</code>ä¸ä¼šç«‹å³åˆ·æ–°ã€‚</li><li><code>sizeThatFits:</code>ä¼šè®¡ç®—å‡ºæœ€ä¼˜çš„sizeï¼Œå¹¶è¿”å›ç»™ä½ ï¼Œä½†æ˜¯viewæœ¬èº«å¹¶ä¸ä¼šæ”¹å˜sizeã€‚</li><li><code>sizeToFit</code>ä¼šè®¡ç®—å‡ºæœ€ä¼˜sizeï¼Œå¹¶ä¸”æ”¹å˜viewè‡ªèº«çš„size</li></ul><ol><li><p><code>layoutSubviews</code>è°ƒç”¨æ—¶æœºï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰<br>ç›´æ¥è°ƒç”¨<code>[self setNeedsLayout];</code> ã€‚<br><code>initWithframe:</code>å¦‚æœåˆå§‹<code>frame</code>ä¸º<code>CGRectZero</code>åˆ™ä¸è°ƒç”¨ï¼Œå¦åˆ™è°ƒç”¨<br><code>addSubview</code>çš„æ—¶å€™ã€‚<br><code>view</code> çš„ <code>size</code>å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œ<strong>å‰ææ˜¯<code>frame</code>çš„å€¼è®¾ç½®å‰åå‘ç”Ÿå˜åŒ–</strong>ã€‚<br>æ»‘åŠ¨<code>UIScrollView</code>çš„æ—¶å€™ã€‚<br>æ—‹è½¬<code>Screen</code>ä¼šè§¦å‘çˆ¶<code>View</code>ä¸Šçš„<code>layoutSubviews</code>äº‹ä»¶**(å¾…éªŒè¯ï¼Œä½œè€…è¯´éªŒè¯è¿‡æ²¡æœ‰è§¦å‘)</p></li><li><p><code>setNeedsDisplay</code>è°ƒç”¨æ—¶æœº<br>è¯¥æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨<code>drawRect</code>æ–¹æ³•ã€‚<code>drawRect</code>æ–¹æ³•ä¸»è¦ç”¨æ¥ç”»å›¾ã€‚<br>soï¼š<br>å½“éœ€è¦åˆ·æ–°å¸ƒå±€æ—¶ï¼Œç”¨<code>setNeedsLayOut</code>æ–¹æ³•ï¼›<br>å½“éœ€è¦é‡æ–°ç»˜ç”»æ—¶ï¼Œè°ƒç”¨<code>setNeedsDisplay</code>æ–¹æ³•ã€‚</p></li></ol><h4 id="ç²—æµ…çš„æ€»ç»“"><a href="#ç²—æµ…çš„æ€»ç»“" class="headerlink" title="ç²—æµ…çš„æ€»ç»“"></a>ç²—æµ…çš„æ€»ç»“</h4><p>æ€»çš„æ¥è¯´ï¼šæˆ‘ä»¬å¯ä»¥é‡å†™çˆ¶ç±»çš„<code>layoutSubviews</code> å’Œ <code>drawRect</code> æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨å®ƒä»¬ï¼Œè€Œæ˜¯éœ€è¦åˆ†åˆ«è°ƒç”¨<code>setNeedsLayout</code> å’Œ <code>setNeedsDisplay</code>è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è§¦å‘ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>iOSå†…è´­ï¼ˆIAPï¼‰é‚£äº›äº‹</title>
    <link href="/2018/07/31/iOS%E5%86%85%E8%B4%AD%EF%BC%88IAP%EF%BC%89%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <url>/2018/07/31/iOS%E5%86%85%E8%B4%AD%EF%BC%88IAP%EF%BC%89%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ä¸ªé¡¹ç›®å®¢æˆ·æ€»æ˜¯ååº”æ‰å•ï¼Œäºæ˜¯ä¹å°±çœ‹äº†çœ‹å†…è´­ç›¸å…³çš„ä¸œè¥¿ï¼Œå‘ç°å‘è¿˜çœŸæ˜¯ä¸å°‘ï¼Œè¿™é‡Œåšä¸ªæ€»ç»“ã€‚</p><blockquote><p>IAPï¼Œå³in-App Purchaseï¼Œæ˜¯ä¸€ç§æ™ºèƒ½ç§»åŠ¨ç»ˆç«¯åº”ç”¨ç¨‹åºä»˜è´¹çš„æ¨¡å¼ï¼Œåœ¨è‹¹æœï¼ˆAppleï¼‰iOSã€è°·æ­Œå®‰å“ï¼ˆGoogle Androidï¼‰ã€å¾®è½¯WindowsPhoneç­‰æ™ºèƒ½ç§»åŠ¨ç»ˆç«¯æ“ä½œç³»ç»Ÿä¸­éƒ½æœ‰ç›¸åº”çš„å®ç°ã€‚<br>â€“ ç™¾åº¦ç™¾ç§‘</p></blockquote><span id="more"></span><h3 id="å†…è´­æµç¨‹"><a href="#å†…è´­æµç¨‹" class="headerlink" title="å†…è´­æµç¨‹"></a>å†…è´­æµç¨‹</h3><p>æƒ³çŸ¥é“å‘åœ¨å“ªé‡Œï¼Œé¦–å…ˆåº”è¯¥äº†è§£æµç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆé€šè¿‡å†…è´­çš„æµç¨‹ï¼Œä¸€æ­¥æ­¥åœ°è¯´å‘åˆ°åº•åœ¨å“ªé‡Œã€‚<br>è‹¹æœå†…è´­çš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs flow">è·å–å•†å“ä¿¡æ¯ =&gt; åˆ›å»ºäº¤æ˜“ =&gt; æŠŠäº¤æ˜“æ·»åŠ åˆ°é˜Ÿåˆ— =&gt; äº¤æ˜“æˆåŠŸè·å–å‡­è¯ <br>=&gt; æ‹¿ç€å‡­è¯åšäºŒæ¬¡éªŒè¯ =&gt; äº¤æ˜“æˆåŠŸ<br></code></pre></td></tr></table></figure><ol><li><p>é€šè¿‡äº§å“IDè·å–å•†å“ä¿¡æ¯ï¼ˆSKProductï¼‰ã€‚</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-meta">#import <span class="hljs-string">&lt;StoreKit/StoreKit.h&gt;</span></span><br><br><span class="hljs-comment">//æŠŠå•†å“IDä¿¡æ¯æ”¾å…¥ä¸€ä¸ªé›†åˆä¸­</span><br><span class="hljs-built_in">NSSet</span> *sets = [<span class="hljs-built_in">NSSet</span> setWithObjects:<span class="hljs-string">@&quot;phonicsphase1&quot;</span>, <span class="hljs-literal">nil</span>];<br><span class="hljs-comment">//è¯·æ±‚å†…è´­å•†å“ä¿¡æ¯ï¼Œåªè¿”å›ä½ è¯·æ±‚çš„äº§å“ï¼ˆä¸»è¦ç”¨äºéªŒè¯å•†å“çš„æœ‰æ•ˆæ€§ï¼‰</span><br><span class="hljs-built_in">SKProductsRequest</span> *productrequest = [[<span class="hljs-built_in">SKProductsRequest</span> alloc] initWithProductIdentifiers:sets];<br>productrequest.delegate = <span class="hljs-keyword">self</span>;<br>[productrequest start];<br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - è·å–å•†å“IDæˆåŠŸçš„ä»£ç†æ–¹æ³•</span><br>- (<span class="hljs-type">void</span>)productsRequest:(<span class="hljs-built_in">SKProductsRequest</span> *)request didReceiveResponse:(<span class="hljs-built_in">SKProductsResponse</span> *)response &#123;<br>    <span class="hljs-comment">//è¿”å›çš„æ˜¯SKProductå¯¹è±¡æ•°ç»„</span><br>    <span class="hljs-comment">//å¦‚æœä½ ä¸Šé¢è¯·æ±‚çš„æ˜¯å¤šä¸ªï¼Œé‚£ä¹ˆè¿™é‡Œè¿”å›çš„ä¹Ÿæ˜¯å¤šä¸ª</span><br>    <span class="hljs-built_in">SKProduct</span> *product = [response.products firstObject];<br>    <span class="hljs-comment">//æŸ¥è¯¢æˆåŠŸï¼Œå¼€å§‹æ”¯ä»˜</span><br>    [<span class="hljs-keyword">self</span> startPaymentWithProduct:product];<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ‹¿åˆ°å•†å“ä¿¡æ¯ï¼Œåˆ›å»ºæ”¯ä»˜å¯¹è±¡<code>SKMutablePayment</code>ã€‚</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs objc">- (<span class="hljs-type">void</span>)startPaymentWithProduct:(<span class="hljs-built_in">SKProduct</span> *)product &#123;<br>    <span class="hljs-built_in">SKMutablePayment</span> *payment = [<span class="hljs-built_in">SKMutablePayment</span> paymentWithProduct:product];<br>    payment.applicationUsername = <span class="hljs-string">@&quot;myOrderID&quot;</span>;<br>    [[<span class="hljs-built_in">SKPaymentQueue</span> defaultQueue] addPayment:payment];<br>&#125;<br></code></pre></td></tr></table></figure><p> è¿™é‡Œçš„<code>applicationUsername</code>æ˜¯ä¸€ä¸ªé€ä¼ å­—æ®µï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¼ ä»€ä¹ˆå‚æ•°ï¼Œåœ¨æ”¯ä»˜æˆåŠŸçš„æ—¶å€™Appleä¼šåŸå°ä¸åŠ¨çš„è¿”å›ç»™æˆ‘ä»¬ã€‚æœ€å¸¸ç”¨çš„å°±æ˜¯æ‹¿å®ƒä¼ é€’æˆ‘ä»¬è‡ªå·±çš„è®¢å•å·ï¼Œä»¥ä¾¿è·Ÿæˆ‘ä»¬çŸ¥é“æ˜¯å“ªä¸ªè®¢å•æ”¯ä»˜æˆåŠŸäº†ã€‚<br> <strong>è¿™é‡Œæœ‰ä¸ªå‘ï¼š</strong><br> æ®è¯´æˆ‘ä»¬ä¼ é€’è¿‡å»çš„<code>applicationUsername</code>æœ‰å¯èƒ½è¿”å›çš„æ—¶å€™å˜æˆç©ºçš„ï¼Œè¿™ç‚¹æˆ‘æ²¡æœ‰é‡åˆ°ï¼Œæœ‰é‡åˆ°çš„å¯ä»¥è¯´ä¸€ä¸‹ã€‚</p></li><li><p>æŠŠå½“å‰äº¤æ˜“æ·»åŠ åˆ°äº¤æ˜“é˜Ÿåˆ—ä¸­å»ï¼ˆä¸Šé¢çš„addPayment:æ–¹æ³•ï¼‰ã€‚</p></li><li><p>ç›‘å¬æ”¯ä»˜ç»“æœï¼ˆpaymentQueue:updatedTransactions:ï¼‰ï¼Œå¦‚æœæ”¯ä»˜æˆåŠŸï¼ŒAppleä¼šæŠŠæ”¯ä»˜æˆåŠŸçš„å‡­è¯ï¼ˆreciptï¼‰å­˜åˆ°æ²™ç›’ä¸­ã€‚</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-comment">//é¦–å…ˆæˆ‘ä»¬è¦åœ¨ viewDidLoad æ–¹æ³•ä¸­æ·»åŠ ç›‘å¬å¯¹è±¡ </span><br>[[<span class="hljs-built_in">SKPaymentQueue</span> defaultQueue] addTransactionObserver:<span class="hljs-keyword">self</span>];<br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark -  ç›‘å¬çš„ä»£ç†æ–¹æ³•</span><br>- (<span class="hljs-type">void</span>)paymentQueue:(<span class="hljs-built_in">SKPaymentQueue</span> *)queue updatedTransactions:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">SKPaymentTransaction</span> *&gt; *)transactions &#123;<br>        [transactions enumerateObjectsUsingBlock:^(<span class="hljs-built_in">SKPaymentTransaction</span> * _Nonnull obj, <span class="hljs-built_in">NSUInteger</span> idx, <span class="hljs-type">BOOL</span> * _Nonnull stop) &#123;<br>        <span class="hljs-built_in">SKPaymentTransaction</span> *transation = obj;<br>        <span class="hljs-keyword">switch</span> (transation.transactionState) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-built_in">SKPaymentTransactionStatePurchasing</span>:<br>                &#123;<br>                    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;è´­ä¹°ä¸­&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>                <br>            <span class="hljs-keyword">case</span> <span class="hljs-built_in">SKPaymentTransactionStatePurchased</span>:<br>            &#123;<br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;äº¤æ˜“å®Œæˆ&quot;</span>);<br>                <span class="hljs-comment">//è·å–é€ä¼ å­—æ®µ</span><br>                <span class="hljs-built_in">NSString</span> *orderNo = transation.payment.applicationUsername;<br>                <span class="hljs-comment">//transactionIdentifierï¼šç›¸å½“äºAppleçš„è®¢å•å·</span><br>                <span class="hljs-built_in">NSString</span> *transationId = transation.transactionIdentifier;<br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;orderNo = %@, äº¤æ˜“ID = %@&quot;</span>, orderNo, transationId);<br>                <span class="hljs-comment">//ä»æ²™ç›’ä¸­è·å–äº¤æ˜“å‡­è¯</span><br>                <span class="hljs-built_in">NSData</span> *reciptData = [<span class="hljs-built_in">NSData</span> dataWithContentsOfURL:[[<span class="hljs-built_in">NSBundle</span> mainBundle] appStoreReceiptURL]];<br>                <span class="hljs-comment">//è½¬åŒ–æˆBase64å­—ç¬¦ä¸²ï¼ˆç”¨äºæ ¡éªŒï¼‰</span><br>                <span class="hljs-built_in">NSString</span> *reciptString = [reciptData base64EncodedStringWithOptions:<span class="hljs-built_in">NSDataBase64Encoding64CharacterLineLength</span>];<br>                <span class="hljs-comment">//ä¼ ç»™åå°åšäºŒæ¬¡éªŒè¯</span><br>                [<span class="hljs-keyword">self</span> checkReceipt:reciptString];                <br>            &#125;<br>                <span class="hljs-keyword">break</span>;<br>                <br>            <span class="hljs-keyword">case</span> <span class="hljs-built_in">SKPaymentTransactionStateFailed</span>:<br>            &#123;<br>                <span class="hljs-comment">//localizedDescriptionå¯ä»¥ä½œä¸ºæç¤ºä¿¡æ¯ï¼ˆäº¤æ˜“å¤±è´¥æ— æ³•è¿æ¥åˆ° iTunes Storeï¼‰</span><br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;äº¤æ˜“å¤±è´¥%@&quot;</span>, transation.error.localizedDescription);<br>                [[<span class="hljs-built_in">SKPaymentQueue</span> defaultQueue] finishTransaction:transation];<br>            &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <br>            <span class="hljs-keyword">case</span> <span class="hljs-built_in">SKPaymentTransactionStateRestored</span>:<br>            &#123;<br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;æ¢å¤è´­ä¹°å®Œæˆ&quot;</span>);<br>                <span class="hljs-comment">//æ¢å¤å®Œæˆï¼ˆå¯¹åº”restoreCompletedTransactionsï¼‰æ–¹æ³•</span><br>            &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <br>            <span class="hljs-keyword">case</span> <span class="hljs-built_in">SKPaymentTransactionStateDeferred</span>:<br>            &#123;<br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;äº¤æ˜“æ¨è¿Ÿ, ç­‰å¾…å¤–éƒ¨æ“ä½œ&quot;</span>);<br>                <span class="hljs-comment">//äº¤æ˜“æ¨è¿Ÿ</span><br>                <span class="hljs-comment">//å®˜æ–¹è§£é‡Šæ˜¯ï¼šäº¤æ˜“å·²ç»åŠ å…¥é˜Ÿåˆ—ï¼Œä½†æ˜¯éœ€è¦ç­‰å¾…å¤–éƒ¨æ“ä½œ</span><br>                <span class="hljs-comment">//ä¸»è¦ç”¨äºå„¿ç«¥æ¨¡å¼ï¼Œéœ€è¦è¯¢é—®å®¶é•¿åŒæ„ã€‚è¿™ç§æƒ…å†µä¸‹ä¸èƒ½å…³é—­è®¢å•ï¼ˆå®Œæˆäº¤æ˜“ï¼‰ï¼Œå¦åˆ™è¿™ç±»å……å€¼å°†æ— æ³•å¤„ç†ã€‚                </span><br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>                <br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>æ³¨æ„ï¼š</strong></p><ol><li>é€ä¼ å­—æ®µ<code>applicationUsername</code>å¯èƒ½è¿”å›çš„æ˜¯<code>nil</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸¢å•çš„åŸå› ä¹‹ä¸€ï¼Œæœ‰äº›äººè¯´é‡åˆ°è¿‡ï¼Œæœ‰çš„åˆ™è¯´æ²¡æœ‰é‡åˆ°è¿‡ã€‚è¿™ä¸ªå°šä¸æ¸…æ¥šã€‚</li><li><code>[[SKPaymentQueue defaultQueue] finishTransaction:transation]</code>å¦‚æœä¸è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆ<code>transation</code>å°±æ°¸è¿œä¸ä¼šç»“æŸã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¿›æ¥éƒ½ä¼šé‡æ–°è°ƒç”¨<code>updatedTransactions</code>è¿™ä¸ªæ–¹æ³•ï¼Œ<strong>å°±ç®—ä½ åšè¿‡äºŒæ¬¡æ ¡éªŒéƒ½æ²¡ç”¨</strong>ã€‚</li><li>äºŒæ¬¡æ ¡éªŒåªä¼šæ ¡éªŒä½ çš„å‡­è¯æ˜¯ä¸æ˜¯æœ‰æ•ˆï¼Œä¸ä¼šå…³å¿ƒä½ è¿™ä¸ªå‡­è¯æ˜¯ä¸æ˜¯æ ¡éªŒè¿‡äº†ï¼Œæ‰€ä»¥è¯´ï¼Œ<strong>ä¸€ä¸ªå‡­è¯å¯ä»¥è¢«æ ¡éªŒå¤šæ¬¡ï¼ˆè¿™æ˜¯åˆ·å•æ–¹æ³•ä¹‹ä¸€ï¼‰</strong></li><li>ä¸Šé¢è¯´è¿‡ï¼Œå¦‚æœä¸<code>finishTransaction</code>ï¼Œæ¯æ¬¡è¿›å…¥è¿™ä¸ªç•Œé¢éƒ½ä¼šè°ƒç”¨ç›‘å¬æ–¹æ³•ï¼Œä½†æ˜¯æ³¨æ„äº†<strong>æ¯æ¬¡è¿”å›çš„ reciptDataéƒ½æ˜¯ä¸ä¸€æ ·ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªè®¢å•ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªè®¢å•ä¹Ÿæœ‰å¯èƒ½æœ‰å¤šä¸ª<code>reciptData</code>ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸èƒ½ç”¨æ¥ç¡®å®šæ˜¯å“ªä¸ªè®¢å•ã€‚</li><li>æˆ‘ä»¬æœ€å¥½æ˜¯åœ¨Appå¯åŠ¨çš„æ—¶å€™å°±å»è®¾ç½®ç›‘å¬ã€‚æŠŠå†…è´­å°è£…æˆä¸€ä¸ªå·¥å…·ç±»ï¼Œè¿™æ ·æ¯æ¬¡å¯åŠ¨Appå°±ä¼šè°ƒç”¨è‹¹æœçš„è¡¥å•æµç¨‹ã€‚</li></ol></li><li><p>æˆ‘ä»¬ä»æ²™ç›’ä¸­å–åˆ°å‡­è¯ï¼ˆreciptï¼‰ï¼Œå‘é€ç»™æˆ‘ä»¬è‡ªå·±åå°è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼ŒéªŒè¯æˆåŠŸè¡¨ç¤ºæ”¯ä»˜æˆåŠŸã€‚</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs objc">- (<span class="hljs-type">void</span>)checkReceipt:(<span class="hljs-built_in">NSString</span> *)receipt &#123;<br>    [AntManager postWithPath:CheckReceipt_URL params:params success:^(<span class="hljs-type">id</span> response) &#123;<br>        <span class="hljs-keyword">if</span> ([response[<span class="hljs-string">@&quot;status&quot;</span>] integerValue] == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœæ”¯ä»˜æˆåŠŸï¼Œæˆ‘ä»¬å°±ç»“æŸäº¤æ˜“</span><br>            [[<span class="hljs-built_in">SKPaymentQueue</span> defaultQueue] finishTransaction:transation]<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <br>        &#125;<br>    &#125; failure:^(<span class="hljs-type">id</span> error) &#123;<br>    <br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>æ³¨æ„ï¼š</strong><br> å‰é¢è¯´è¿‡ï¼ŒAppleåœ¨æœ€åˆè®¾è®¡IAPçš„æ—¶å€™å°±æ²¡æœ‰æƒ³è¿‡åå°çš„å‚ä¸ï¼Œä½†æ˜¯ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬è¦æŠŠäºŒæ¬¡éªŒè¯æ”¾åˆ°åå°åšï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬åè¾¹ä¼šè®²åˆ°ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œæˆ‘ä»¬è‡³å°‘è¦äº†è§£ä¸€ä¸‹æ€ä¹ˆåšçš„äºŒæ¬¡æ ¡éªŒã€‚</p><ul><li>æˆ‘ä»¬æŠŠreciptç»è¿‡Base64ç¼–ç ä¹‹åï¼Œä¼ ç»™Appleçš„éªŒè¯æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚<br> æ ¼å¼å¦‚ä¸‹:<br> <code>&#123;&quot;receipt-data&quot;: ä½ ç¼–ç è¿‡çš„recipt&#125;</code></li><li>Appleçš„éªŒè¯æœåŠ¡å™¨åœ°å€æœ‰ä¸¤ä¸ª<br> <code>https://sandbox.itunes.apple.com/verifyReceipt</code> æ˜¯æ²™ç›’ç¯å¢ƒçš„éªŒè¯åœ°å€ã€‚<br> <code>https://buy.itunes.apple.com/verifyReceipt</code> æ˜¯æ­£å¼ç¯å¢ƒçš„éªŒè¯åœ°å€</li><li>å¦‚æœä½ ç”¨çš„æ˜¯æµ‹è¯•è´¦å·ï¼ˆå°±æ˜¯åœ¨iTunes Connecté‡Œé¢è®¾ç½®çš„ï¼Œå…·ä½“è¯·<a href="https://help.apple.com/app-store-connect/#/dev8b997bee1">çœ‹è¿™é‡Œ</a>ï¼‰æ”¯ä»˜çš„ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å‘é€åˆ°æ²™ç›’ç¯å¢ƒçš„éªŒè¯åœ°å€ï¼Œæ­£å¼ç¯å¢ƒåº”è¯¥åˆ‡æ¢åˆ°æ­£å¼ç¯å¢ƒçš„éªŒè¯åœ°å€ã€‚</li></ul></li></ol><p>Appleè¿”å›çš„å®Œæ•´æ•°æ®å¦‚ä¸‹ï¼š</p><pre><code class="hljs"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;environment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Sandbox&quot;</span><br><span class="hljs-attr">&quot;receipt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;receipt_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ProductionSandbox&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;adam_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;app_item_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;bundle_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.BlueMobi.Phonics&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;application_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.5.0&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;download_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;version_external_identifier&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;receipt_creation_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-28 14:08:26 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;receipt_creation_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1530194906000&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;receipt_creation_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-28 07:08:26 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;request_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-08-05 04:50:58 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;request_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1533444658147&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;request_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-08-04 21:50:58 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;original_purchase_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-08-01 07:00:00 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;original_purchase_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1375340400000&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;original_purchase_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-08-01 00:00:00 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;original_application_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;in_app&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>       <span class="hljs-punctuation">&#123;</span><br>           <span class="hljs-attr">&quot;quantity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;product_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*******&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;transaction_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000000404314890&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//è¿™ä¸ªè‹¹æœçš„äº¤æ˜“å”¯ä¸€æ ‡è¯†ç¬¦</span><br>           <span class="hljs-attr">&quot;original_transaction_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000000404314890&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 09:58:41 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1528106321000&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 02:58:41 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 09:58:41 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1528106321000&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 02:58:41 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;is_trial_period&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><br>       <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>       <span class="hljs-punctuation">&#123;</span><br>           <span class="hljs-attr">&quot;quantity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;product_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*******&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;transaction_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000000404523773&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_transaction_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000000404523773&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-05 02:21:26 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1528165286000&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;purchase_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 19:21:26 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-05 02:21:26 Etc/GMT&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date_ms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1528165286000&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;original_purchase_date_pst&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018-06-04 19:21:26 America/Los_Angeles&quot;</span><span class="hljs-punctuation">,</span><br>           <span class="hljs-attr">&quot;is_trial_period&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><br>       <span class="hljs-punctuation">&#125;</span><br>     <span class="hljs-punctuation">]</span><br>   <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>* Appleè¿”å›çš„æ•°æ®ä¹Ÿæ˜¯Jsonæ ¼å¼çš„ï¼Œé‡Œé¢æœ‰ä¸ªå­—æ®µ`status`ï¼Œå½“`status == 0`çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ ¡éªŒæˆåŠŸã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä»¥è¿™ä¸ª`status`ä¸ºæ ‡å‡†ï¼Œæˆ‘ä»¬è¿˜è¦åˆ¤æ–­æˆ‘ä»¬çš„è®¢å•æ˜¯ä¸æ˜¯åœ¨æ ¡éªŒä¿¡æ¯é‡Œé¢ã€‚* å½“`status`ä¸ä¸º0çš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰å…¶ä½™çš„Jsonæ•°æ®çš„ã€‚    <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-number">21000</span>    App Store ä¸èƒ½è¯»å–ä½ æä¾›çš„JSONå¯¹è±¡<br><span class="hljs-number">21002</span>    receipt-data åŸŸçš„æ•°æ®æœ‰é—®é¢˜<br><span class="hljs-number">21003</span>    receipt æ— æ³•é€šè¿‡éªŒè¯<br><span class="hljs-number">21004</span>    æä¾›çš„ shared secret ä¸åŒ¹é…ä½ è´¦å·ä¸­çš„ shared secret<br><span class="hljs-number">21005</span>    receipt æœåŠ¡å™¨å½“å‰ä¸å¯ç”¨<br><span class="hljs-number">21006</span>    receipt åˆæ³•<span class="hljs-punctuation">,</span> ä½†æ˜¯è®¢é˜…å·²è¿‡æœŸ. æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªçŠ¶æ€ç æ—¶<span class="hljs-punctuation">,</span> receipt æ•°æ®ä»ç„¶ä¼šè§£ç å¹¶ä¸€èµ·å‘é€<br><span class="hljs-number">21007</span>    receipt æ˜¯ Sandbox receipt<span class="hljs-punctuation">,</span> ä½†å´å‘é€è‡³ç”Ÿäº§ç³»ç»Ÿçš„éªŒè¯æœåŠ¡<br><span class="hljs-number">21008</span>    receipt æ˜¯ç”Ÿäº§ receipt<span class="hljs-punctuation">,</span> ä½†å´å‘é€è‡³ Sandbox ç¯å¢ƒçš„éªŒè¯æœåŠ¡<br></code></pre></td></tr></table></figure>* `in_app`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸€æ¡æ•°æ®å¯¹åº”ä¸€æ¡äº¤æ˜“ã€‚åå°éœ€è¦éå†æ•°ç»„ï¼Œè·Ÿæˆ‘ä»¬ä¼ é€’ç»™åå°çš„`transaction_id`åšå¯¹æ¯”ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨å•Šï¼Œå¦‚æœå­˜åœ¨å°±è¯´æ˜æœ¬æ¡äº¤æ˜“æ ¡éªŒæˆåŠŸäº†ã€‚* æœ‰äººè¯´`in_app`é‡Œé¢çš„æ•°æ®æ˜¯æŒ‰ç…§æ—¶é—´å…ˆåæ¥æ’åºçš„ï¼Œåªå–ç¬¬ä¸€æ¡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ç»è¿‡æˆ‘çš„æµ‹è¯•å‘ç°å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯é€æ¡å¯¹æ¯”ã€‚</code></pre><h3 id="æ‰å•é—®é¢˜çš„æ¢è®¨"><a href="#æ‰å•é—®é¢˜çš„æ¢è®¨" class="headerlink" title="æ‰å•é—®é¢˜çš„æ¢è®¨"></a>æ‰å•é—®é¢˜çš„æ¢è®¨</h3><p>è‹¹æœçš„IAPç¼ºé™·è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œè°è®©è‹¹æœä¸€å®¶ç‹¬å¤§å‘¢ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½ååæ§½ï¼Œæƒ³å°½ä¸€åˆ‡åŠæ³•é˜²æ­¢æ‰å•çš„å‘ç”Ÿã€‚<br>æ‰å•çš„åŸå› æ˜¯æœ‰å¤šæ–¹é¢çš„ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥è¯´ã€‚</p><ol><li><p>é¦–å…ˆè‹¹æœæ˜¯æœ‰è¡¥å•æªæ–½çš„ï¼Œå¦‚æœä¸finishäº¤æ˜“ï¼Œæ¯æ¬¡éƒ½ä¼šè¯·æ±‚<code>updatedTransactions:</code>æ–¹æ³•çš„ã€‚ä½†æ˜¯å‰é¢è¯´äº†ï¼Œ<code>applicationUsername</code>çš„ç¼ºå¤±ä¼šå¯¼è‡´æ‰å•ã€‚<code>applicationUsername</code>çš„ä¸¢å¤±ä¼šè®©æˆ‘ä»¬ä¸¢å¤±è®¢å•å·ï¼Œä½†æ˜¯å®é™…çš„æ”¯ä»˜ä»ç„¶æ˜¯æˆåŠŸçš„ã€‚</p><ol><li>å¯ä»¥ä¼ é€’ç»™åå°<code>æœªçŸ¥è®¢å•</code>ï¼Œä½†å®¢æˆ·æŠ•è¯‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»æœªçŸ¥è®¢å•é‡Œé¢æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç»™æ¢å¤è®¢å•ä¿¡æ¯ï¼ˆè¿™æ ·åšæ˜¾ç„¶æ•ˆç‡å¾ˆä½ï¼‰</li><li><strong>å¸¸ç”¨çš„åšæ³•æ˜¯ï¼š</strong><ul><li>æŠŠæ¯ä¸ªè®¢å•çš„<code>recipt</code>ã€<code>orderNumber</code>ã€<code>userId</code>ã€<code>transactionIdentifier</code>ç­‰ä½ éœ€è¦çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªplistæ–‡ä»¶ï¼Œæ¯ä¸ªplistæ–‡ä»¶å¯¹åº”ä¸€ä¸ªè®¢å•ã€‚ç­‰æˆ‘ä»¬åå°è¿”å›æ”¯ä»˜æˆåŠŸçš„æ—¶å€™å°±åˆ é™¤ç›¸åº”çš„plistã€‚</li><li>æ¯æ¬¡å¯åŠ¨Appçš„æ—¶å€™å»æ²™ç›’æŸ¥æ‰¾plistæ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œå°±è¯»å–plistæ–‡ä»¶å»è¯·æ±‚æœåŠ¡å™¨åšäºŒæ¬¡éªŒè¯ï¼Œç›´åˆ°æœåŠ¡å™¨è¿”å›æˆåŠŸä¸ºæ­¢ã€‚</li><li>ä½†æ˜¯è¿™æ ·åšï¼Œå°±éœ€è¦åœ¨<code>SKPaymentTransactionStatePurchased</code>çš„æ—¶å€™<code>finishTransaction:</code>ç»“æŸäº¤æ˜“ï¼Œå› ä¸ºæ¯æ¬¡è¿”å›çš„<code>reciptData</code>æ˜¯ä¸åŒçš„ã€‚é™¤éæˆ‘ä»¬æ¯æ¬¡éƒ½å»æ›´æ–°å®ƒã€‚å¹¶ä¸”è¿™æ ·åšçš„è¯ï¼Œç”¨æˆ·å¸è½½Appçš„æ—¶å€™ï¼Œä¿å­˜çš„è®¢å•ä¿¡æ¯å…¨éƒ¨éƒ½æ²¡æœ‰äº†ã€‚</li></ul></li><li>ç”¨æˆ·æ”¯ä»˜è¿‡åï¼Œæ²¡æœ‰ç­‰åˆ°éªŒè¯ï¼Œå°±æ›´æ¢Appleè´¦å·ç™»å½•ã€‚è¿™ç§æƒ…å†µæˆ‘æ²¡æœ‰è¯•è¿‡ä¼šä¸ä¼šè°ƒç”¨<code>updatedTransactions:</code>æ–¹æ³•</li><li>å…¶å®è¿™ä¸ªé—®é¢˜å§‹ç»ˆæ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œåªèƒ½é è‹¹æœçš„ä¼˜åŒ–äº†ã€‚</li></ol></li><li><p>ç”±äºè‹¹æœçš„æœåŠ¡å™¨åœ¨ç¾å¸ï¼Œæ‰€ä»¥å»¶è¿Ÿçš„æƒ…å†µè¿˜æ˜¯å¾ˆä¸¥é‡çš„ï¼Œè¿™æ—¶å€™å¦‚æœæ˜¯è¯·æ±‚è¶…æ—¶ï¼Œæˆ‘ä»¬æœåŠ¡å™¨åˆæ²¡æœ‰æ”¶åˆ°å›è°ƒï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ‰å•ã€‚æ¯”è¾ƒå‘çš„æ˜¯ï¼Œ<code>updatedTransactions:</code><strong>åœ¨Appæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªä¼šèµ°ä¸€æ¬¡ã€‚</strong>å…¶å®è¿™ç§æƒ…å†µåªè¦é‡å¯Appå°±ä¼šé‡æ–°èµ°è‹¹æœçš„è¡¥å•æµç¨‹äº†ã€‚å¤§ä½¬ä»¬å¦‚æœè§‰å¾—ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œå¯ä»¥æŠŠä¿¡æ¯å­˜æœ¬åœ°ï¼Œéš”ä¸€æ®µæ—¶é—´è¯·æ±‚ä¸€æ¬¡æœåŠ¡å™¨ã€‚<br>å…¶å®ç°åœ¨æ‰å•åŸºæœ¬å°±æ˜¯ä¸Šé¢è¯´çš„é‚£ä¸ªåŸå› äº†ï¼Œåªè¦æŠŠå®ƒè§£å†³äº†ï¼Œæ‰å•åŸºæœ¬ä¸Šä¹Ÿå°±æ²¡æœ‰äº†ã€‚</p></li></ol><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>æ‰å•é—®é¢˜éƒ½æ˜¯å‡ºç°åœ¨æ”¯ä»˜å®Œæˆä¹‹åï¼Œæ²¡æœ‰é€šè¿‡äºŒæ¬¡æ ¡éªŒçš„æ—¶å€™ã€‚å› ä¸ºä¸€æ—¦æˆ‘ä»¬å¾—åˆ°äº†<code>recipt</code>ï¼Œå°±è¯´æ˜è‹¹æœå·²ç»æ‰£æ¬¾æˆåŠŸäº†ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ä»¥è¿™ä¸ªä½œä¸ºæ”¯ä»˜æˆåŠŸçš„æ ‡å‡†å‘¢ï¼Œè¯·çœ‹ä¸‹é¢çš„åˆ·å•ç³»åˆ—ã€‚</li><li>é’ˆå¯¹ä¸Šé¢ç¬¬äºŒç§<code>recipt</code>å­˜æœ¬åœ°çš„æ–¹æ³•ï¼Œå…¶å®æ²¡æœ‰å¿…è¦ï¼Œè‹¹æœè‡ªå·±çš„è¡¥å•æªæ–½åŸºæœ¬ä¸Šæ˜¯å¤Ÿç”¨äº†ã€‚</li><li>å¦‚æœæ˜¯ä½ ä»¬çš„Appä¸­ï¼Œç”¨æˆ·å¯ä»¥ä¸€æ¬¡æ€§è´­ä¹°å¤šä¸ªäº§å“ï¼Œé‚£ä¹ˆæ›´æ¨èæŠŠ<code>recipt</code>å­˜æœ¬åœ°ã€‚å› ä¸ºå¦‚æœåœ¨æœ‰å¤šä¸ªæˆåŠŸäº¤æ˜“æœª finish æ‰çš„æƒ…å†µä¸‹æŠŠåº”ç”¨å…³é—­åå†æ¬¡æ‰“å¼€çš„æ—¶å€™ï¼Œæœ‰äº›äº¤æ˜“çš„å›è°ƒä¼šè¢«æ¼æ‰ï¼ˆè‹¹æœçœŸå‘å•Šï¼ï¼ï¼ï¼‰ã€‚å½“ç„¶ä¸¤è€…ç»“åˆä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚</li></ol><h3 id="åˆ·å•çš„é—®é¢˜"><a href="#åˆ·å•çš„é—®é¢˜" class="headerlink" title="åˆ·å•çš„é—®é¢˜"></a>åˆ·å•çš„é—®é¢˜</h3><p>åˆ·å•çš„è½¬è‡ª<a href="https://blog.csdn.net/autfish/article/details/52682778">è¿™ç¯‡åšå®¢</a><br>æˆ‘åœ¨è¿™é‡Œç®€è¿°ä¸€ä¸‹ï¼Œåšä¸ªå°ç»“ã€‚</p><p>åˆ·å•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li>ç ´è§£IAP</li><li>é‡å¤ä½¿ç”¨<code>recipt-data</code></li><li>ä¿¡ç”¨å¡é»‘å¡</li><li>å¤–å¸å·®ä»·</li><li>ä»¥åŠè‹¹æœå¯¹å°é¢æ¶ˆè´¹ä¸åšéªŒè¯è§„åˆ™çš„â€œ36æŠ€æœ¯â€</li></ol><p>æˆ‘ä»¬è¿™é‡Œåªè®¨è®º 1 å’Œ 2 ï¼Œå› ä¸ºä¸‹é¢ä¸‰ç§è·Ÿæˆ‘ä»¬å¼€å‘è€…æ²¡æœ‰å…³ç³»ï¼Œæƒ³è¦è¯¦ç»†äº†è§£çš„å¯ä»¥å»å¼€å¤´çš„åšå®¢ä¸Šäº†è§£ä¸€ä¸‹ã€‚</p><h4 id="1-ç ´è§£IAP"><a href="#1-ç ´è§£IAP" class="headerlink" title="1. ç ´è§£IAP"></a>1. ç ´è§£IAP</h4><p>   è¿™ä¸ªä¸»è¦æ˜¯æˆ‘ä»¬ä¸åšäºŒæ¬¡éªŒè¯å¼•å‘çš„æ¼æ´ï¼Œéæ³•ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ’ä»¶æ¨¡æ‹Ÿæ‰£æ¬¾æˆåŠŸï¼Œæœ‰å¯èƒ½æ˜¯æ‰‹åŠ¨è°ƒç”¨<code>updatedTransactions:</code>ï¼ˆæˆ‘çŒœçš„ğŸ˜‚ï¼‰ã€‚å°±ç®—æ˜¯æˆ‘ä»¬åœ¨Appç«¯åšäº†äºŒæ¬¡éªŒè¯ï¼Œç»“æœä¹Ÿæœ‰å¯èƒ½æ˜¯è¢«ç¯¡æ”¹è¿‡çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„æœåŠ¡ç«¯è¿›è¡ŒäºŒæ¬¡éªŒè¯ã€‚ <strong>ä»»ä½•åœ¨Appç«¯çš„æ•°æ®éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼ï¼ï¼</strong></p><h4 id="2-é‡å¤ä½¿ç”¨recipt-data"><a href="#2-é‡å¤ä½¿ç”¨recipt-data" class="headerlink" title="2. é‡å¤ä½¿ç”¨recipt-data"></a>2. é‡å¤ä½¿ç”¨<code>recipt-data</code></h4><p>   æˆ‘ä»¬ç›´åˆ°ï¼Œ<code>recipt-data</code>æ˜¯æ”¯ä»˜æˆåŠŸè¿”å›ç»™æˆ‘ä»¬çš„æ ¡éªŒå‡­è¯ï¼Œå‰é¢è¯´è¿‡ï¼Œè‹¹æœæ ¡éªŒçš„æ—¶å€™åªè´Ÿè´£æ ¡éªŒreciptçš„æœ‰æ•ˆæ€§å’ŒçœŸå‡ï¼Œå¹¶ä¸è´Ÿè´£è¿™ä¸ªå‡­è¯æ˜¯å¦è¢«ç”¨è¿‡ã€‚å¦‚æœæˆ‘ä»¬åœ¨åå°åªåˆ¤æ–­<code>status == 0</code>ï¼Œè€Œä¸å»åšå…¶ä»–åˆ¤æ–­çš„è¯ï¼Œéæ³•ç”¨æˆ·ä¼šä¿å­˜<code>recipt-data</code>ï¼Œç„¶åå¤šæ¬¡ä½¿ç”¨ï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯æ ¡éªŒé€šè¿‡çš„ã€‚</p><p>   æˆ‘ä»¬ä¹Ÿä¸èƒ½åˆ¤æ–­<code>recipt-data</code>æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå› ä¸ºä¸Šé¢å·²ç»è¯´è¿‡ï¼ŒåŒä¸€ä¸ªè®¢å•ä¹Ÿä¼šæœ‰å¤šä¸ª<code>recipt-data</code>è¿”å›çš„ã€‚</p><p>   é˜²èŒƒçš„æ–¹æ³•æ˜¯åœ¨ç¡®å®šstatuså€¼ä¸º0åï¼Œè¿›ä¸€æ­¥è§£æå‡ºæ•°æ®ä¸­çš„transaction_idå¹¶å­˜å…¥æ•°æ®åº“ã€‚æ¯æ¬¡å‘è´§å‰å…ˆæ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²ç»æœ‰æœ¬æ¬¡çš„transaction_idå­˜åœ¨ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™æ‹’ç»å‘è´§ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µéœ€è¦æ³¨æ„ï¼Œæœ‰äº›Appè´­ä¹°å‰å…ˆæœ‰ä¸€æ­¥åˆ›å»ºè®¢å•çš„è¡Œä¸ºï¼Œåœ¨æœåŠ¡å™¨ç«¯è®°å½•è´­ä¹°çš„å•†å“ã€æ—¶é—´ç­‰ï¼Œä¸”å‘è´§æ—¶æ˜¯æŒ‰ç…§è®¢å•è®°å½•ä¸­çš„å•†å“ï¼Œé‚£ä¹ˆéœ€è¦æ¯”è¾ƒè‹¹æœè¿”å›ä¿¡æ¯ä¸­çš„product_idä¸è®¢å•è¡¨ä¸­çš„è®°å½•å€¼æ˜¯å¦ä¸€è‡´ã€‚</p><p>åˆ°äº†è¿™é‡ŒIAPåŸºæœ¬ä¸Šå·²ç»ç»“æŸäº†ï¼Œå°å¼Ÿåªæ˜¯æŠŠIAPçš„æµç¨‹ä»¥åŠéœ€è¦æ³¨æ„çš„ç‚¹åˆ—å‡ºæ¥ï¼Œä»¥ä¸Šçš„æ–¹æ³•åªæ˜¯ä½œä¸ºæ€»ç»“ï¼Œå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰çŠ¶å†µï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­è¿˜è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚å¸Œæœ›å¤§å®¶å¼€å‘ä¸­éƒ½ä¸ä¼šæ‰å•ğŸ˜„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>iOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
